DelphesJetSubstructure
======================

Calculate Jet Substructure variables for Delphes output

Before running make in this directory, please, update the LocalSettings.C file with the appropriate paths on your system.

How to build:

Get the latest copy of fastjet library and untar the file: 
wget http://fastjet.fr/repo/fastjet-3.0.6.tar.gz
tar -xzf fastjet-3.0.6.tar.gz 

Build fastjets and run the install script:

cd fastjet-3.0.6
./configure --prefix=$PWD/../fastjet-install
make
make check
make install

Go to the bin folder and add it to your path (youâ€™ll need to repeat this step every time you run a new terminal session) and go back to the folder where you started:

cd ../fastjet-install/bin/
export PATH=$PATH:`pwd`
cd ../../

Get the fastjet-contrib library from http://fastjet.hepforge.org/contrib/

wget http://fastjet.hepforge.org/contrib/downloads/fjcontrib-1.011.tar.gz

Untar, build and install it:

tar -xzf fjcontrib-1.011.tar.gz 
cd fjcontrib-1.011
./configure 
make
make check
make install

Currently, a very specific version of Delphes is needed to maintain compatibility. You can obtain the correct Delphes version from: http://cp3.irmp.ucl.ac.be/downloads/Delphes-3.0.12.tar.gz
Export the path to your Delphes library:
export DELPHESPATH=/Research/MadGraph5_v1_5_12/Delphes # You should replace this path with the path where you installed Delphes

Source root: (this will vary, depending on your system, for the tev cluster use localSetupROOT)

source /Research/root/bin/thisroot.sh # path will vary depending on your installtion

Or on the tev cluster use localSetupROOT
 
Run make in the DelphesJetSubstructure folder. This will build two binaries - ha and miniha. ha runs the jet substructure analysis and creates mini tuples with the results, miniha runs the analysis on the mini tuples themselves.

A note on dependencies:
The DelphesJetSubstructure code is written using the various optimizations of the new C++11 standard. C++11 must be installed in your development environment to be able to compile the code. C++11 is included in gcc version >= 4.6, available on most modern distributions (ubuntu, fedora, OS X, etc). However, the popular Red Hat/CentOS/Scientific Linux distributions come with gcc 4.4 in their repositories, and C++11 support must be installed separately. The recommended development tools to install on those distributions is the devtoolset, supplied by Red Hat (and more recently CERN). They can be found here:

http://ftp.scientificlinux.org/linux/scientific/6x/external_products/devtoolset/
http://linux.web.cern.ch/linux/devtoolset/#install


When you run make successsfully, you will have four executables built: ha, miniha, extras and truthbtag

  ha: ha runs the jet substructure analysis on a root file generated by Delphes. That includes running the qjet plugin and calculating the n-subjetinness. The output of has is mini-tuple containing only the final state particles and the jet substructure variables. The output files have the name of the input file with an added prefix of "mintree_jetsub_" e.g. my_data_file.root will result in output of mintree_jetsub_my_data_file.root.
  Running ha with no parameters on the command line will fork ha analysis process for all masses of A listed in the RunHeavyHiggs function in Run.C. The input files are expected to have the form a-zh-XXXGeV.root, where XXX is the mass of A in GeV. This can be changed in the same function. Running ha with a file name will result in running the jet substructure analysis code only on this mass of A. Note that you need to specify only the file name, as in ha a-zh-500GeV.root - ha will still find the file in the input folder specified in LocalSettings.C.

 miniha: miniha runs additional analysis on the minituples generated by ha. It does any cuts, reconstructs the events, generated the kinematics histograms and calculates the significance and the yields. It uses the input/output folders define in LocalSetting.C. It expects the minituples to be named mintree_jetsub_a-zh-XXXGeV.root where XXX is the mass of A. It stores the results in res-mintree_jetsub_a-zh-XXXGeV.root.

 extras: extras reads the output of miniha and constructs some generates some useful plots by superimposing the histograms for 0.8/1.2 cones.

 truthbtag: truthbtag is a sample of how to do b-tagging in the analysis code. It provides a simple way to iterate over events and uses the Particle branch to determine whether a Jet is close enough to a b/~b.